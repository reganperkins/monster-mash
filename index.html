<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src='lib/quintus.js'></script>
        <script src='lib/quintus_sprites.js'></script>
        <script src='lib/quintus_scenes.js'></script>
        <script src='lib/quintus_input.js'></script>
        <script src='lib/quintus_anim.js'></script>
        <script src='lib/quintus_2d.js'></script>
        <script src='lib/quintus_touch.js'></script>
        <script src='lib/quintus_ui.js'></script>
    </head>
    <body style="background-color: black;">
        <script>
            var Q = Quintus()
                .include("Sprites, Scenes, Input, 2D, Touch, UI")
                .setup({
                    width: 960,
                    height: 640
                }).controls().touch();

            //Player Class
            Q.Sprite.extend("Player",{
            init: function(p) {
              this._super(p, { asset: "monsterb.png", x: 110, y: 50, jumpSpeed: -380});
              this.add('2d, platformerControls');              
            },
            step: function(dt) {
                if(Q.inputs['left'] && this.p.direction == 'right') {
                    this.p.flip = 'x';
                } 
                if(Q.inputs['right']  && this.p.direction == 'left') {
                    this.p.flip = false;                    
                }
            }                    
            });  

            //level layers
            Q.scene("level1",function(stage) {          
            var background = new Q.TileLayer({ dataAsset: 'level1.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE });
            stage.insert(background);  

            stage.collisionLayer(new Q.TileLayer({ dataAsset: 'level1.tmx', layerIndex:1,  sheet: 'tiles', tileW: 70, tileH: 70 })); 

            var player = stage.insert(new Q.Player());

            stage.insert(new Q.VerticalEnemy({x: 800, y: 120, rangeY: 70, asset: "fly.png" }));

            stage.add("viewport").follow(player,{x: true, y: true},{minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});     

            });

            //enemy that goes up and down
            Q.Sprite.extend("VerticalEnemy", {
                init: function(p) {
                    this._super(p, {vy: -100, rangeY: 200, gravity: 0 });
                    this.add("2d");
                    
                    this.p.initialY = this.p.y;
                    
                    //TODO: check for player collisions, die or kill accordingly
                },
                step: function(dt) {                
                    if(this.p.y - this.p.initialY >= this.p.rangeY && this.p.vy > 0) {
                        this.p.vy = -this.p.vy;
                    } 
                    else if(-this.p.y + this.p.initialY >= this.p.rangeY && this.p.vy < 0) {
                        this.p.vy = -this.p.vy;
                    } 
                }
            });
            init: function(p) {
                this._super(p, {vy: -100, rangeY: 200, gravity: 0 });
                this.add("2d");
                
                this.p.initialY = this.p.y;
                
                this.on("bump.left,bump.right,bump.bottom",function(collision) {
                    if(collision.obj.isA("Player")) { 
                      Q.stageScene("endGame",1, { label: "Game Over" }); 
                      collision.obj.destroy();
                    }
                });
                this.on("bump.top",function(collision) {
                    if(collision.obj.isA("Player")) { 
                          collision.obj.p.vy = -100;
                      this.destroy();
                    }
                });
                Q.scene("endGame",function(stage) {
                    alert("game over");
                    window.location = "";
                });
            },

            //load assets
            Q.load("tiles_map.png, monsterb.png, fly.png, level1.tmx", function() {
              Q.sheet("tiles","tiles_map.png", { tilew: 70, tileh: 70});

              Q.stageScene("level1");
            });
            

        </script>
    </body>
</html>